<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chatbot - Multi-Mode Assistant</title>
    <link rel="stylesheet" href="../assets/css/ai-chatbot.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar Overlay for Mobile -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="app.toggleSidebar()"></div>

        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <button class="new-chat-btn" onclick="app.createNewChat()">+ New Chat</button>
            </div>

            <!-- Mode Selector -->
            <div class="mode-selector">
                <label for="modeSelect">Chat Mode</label>
                <select id="modeSelect" class="mode-select" onchange="app.changeChatMode(this.value)">
                    <!-- <option value="agent">AI Agent</option> -->
                    <option value="custom">Custom AI</option>
                    <!-- <option value="url">URL Context</option> -->
                </select>
            </div>

            <!-- Chat History -->
            <div class="chat-history">
                <input type="text" class="chat-history-search" placeholder="Search conversations..."
                       oninput="app.searchChats(this.value)">
                <div id="chatHistoryList"></div>
            </div>

            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                <button class="sidebar-logout-btn" onclick="app.logout()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <span>Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="main-header">
                <div style="display: flex; align-items: center; gap: 8px; flex: 1; min-width: 0;">
                    <button class="sidebar-toggle-btn" onclick="app.toggleSidebar()" title="Toggle Sidebar">‚ò∞</button>
                    <h1 class="header-title" id="headerTitle" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">AI Chatbot</h1>
                </div>
                <div class="header-actions">
                    <button class="header-btn" onclick="app.toggleContextPanel()">Context</button>
                    <a href="admin-panel.html" class="header-btn admin-btn" id="adminPanelLink" title="Admin Panel" style="display: none;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"></path>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z"></path>
                        </svg>
                    </a>
                    <a href="user-panel.html" class="header-btn profile-btn" title="User Settings">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </a>
                </div>
            </header>

            <!-- Context Panel -->
            <div class="context-panel" id="contextPanel">
                <!-- URL Context Section -->
                <div class="context-section" id="urlContextSection" style="display: none;">
                    <div class="context-label">Saved URL Contexts</div>
                    <div style="display: flex; gap: 8px; margin-bottom: 12px;">
                        <select class="system-prompt-select" id="urlContextSelect" onchange="app.selectUrlContext(this.value)" style="flex: 1;">
                            <option value="">Select a URL context...</option>
                        </select>
                        <button class="header-btn" onclick="app.openUrlContextsModal()" style="white-space: nowrap;">Manage</button>
                    </div>
                    <div class="context-label">Current URLs</div>
                    <div class="url-input-group">
                        <input type="url" class="url-input" id="urlInput" placeholder="Enter URL...">
                        <button class="add-url-btn" onclick="app.addUrl()">Add URL</button>
                    </div>
                    <div class="url-list" id="urlList"></div>
                    <button class="btn-primary" onclick="app.saveCurrentUrlContext()" style="margin-top: 12px; width: 100%; font-size: 13px;">
                        üíæ Save Current URLs as Context
                    </button>
                </div>


                <!-- System Prompt Selection -->
                <div class="context-section" id="customAiSection" style="display: none;">
                    <div class="context-label">System Prompt</div>
                    <select class="system-prompt-select" id="systemPromptSelect" onchange="app.selectSystemPrompt(this.value)">
                        <option value="">Select a system prompt...</option>
                    </select>
                    <button class="context-manage-btn" onclick="app.openSystemPromptsModal()" style="margin-top: 12px;">
                        ‚öôÔ∏è Manage System Prompts
                    </button>
                </div>

                <!-- Agent Selection -->
                <div class="context-section" id="agentSection" style="display: none;">
                    <div class="context-label">AI Agent</div>
                    <select class="system-prompt-select" id="agentSelect" onchange="app.selectAgent(this.value)">
                        <option value="">Select an agent...</option>
                        <option value="general">General Assistant</option>
                        <option value="coder">Code Assistant</option>
                        <option value="writer">Writing Assistant</option>
                        <option value="researcher">Research Assistant</option>
                        <option value="analyst">Data Analyst</option>
                    </select>
                </div>
            </div>

            <!-- Chat Area -->
            <div class="chat-area" id="chatArea">
                <div class="empty-state">
                    <h2 id="welcomeMessage">Welcome to AI Chatbot</h2>
                    <p>Select a chat mode and start a conversation</p>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <div class="input-container">
                    <button class="attach-btn" onclick="document.getElementById('fileAttachment').click()" title="Attach files">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                        </svg>
                    </button>
                    <input type="file" id="fileAttachment" multiple style="display: none;" onchange="app.handleFileAttachment(event)">
                    <div class="input-wrapper">
                        <div class="message-input-container">
                            <div class="attached-files" id="attachedFilesList"></div>
                            <textarea class="message-input" id="messageInput" placeholder="Type your message..."
                                      rows="1" onkeydown="app.handleKeyPress(event)"></textarea>
                        </div>
                    </div>
                    <button class="send-btn" onclick="app.sendMessage()">Send</button>
                </div>
            </div>
        </main>
    </div>

    <!-- System Prompts Modal -->
    <div class="modal" id="systemPromptsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">System Prompts</h2>
                <button class="modal-close" onclick="app.closeModal('systemPromptsModal')">&times;</button>
            </div>
            <button class="btn-primary" onclick="app.openCreatePromptModal()" style="margin-bottom: 16px; width: 100%;">
                + Create New Prompt
            </button>
            <div class="prompt-list" id="promptList"></div>
        </div>
    </div>

    <!-- Create/Edit Prompt Modal -->
    <div class="modal" id="promptEditorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="promptEditorTitle">Create System Prompt</h2>
                <button class="modal-close" onclick="app.closeModal('promptEditorModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Prompt Name</label>
                <input type="text" class="form-input" id="promptName" placeholder="Enter prompt name...">
            </div>
            <div class="form-group">
                <label class="form-label">System Prompt</label>
                <textarea class="form-textarea" id="promptContent" placeholder="Enter system prompt..."></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="app.closeModal('promptEditorModal')">Cancel</button>
                <button class="btn-primary" onclick="app.savePrompt()">Save</button>
            </div>
        </div>
    </div>

    <!-- Rename Chat Modal -->
    <div class="modal" id="renameChatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Rename Conversation</h2>
                <button class="modal-close" onclick="app.closeModal('renameChatModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Chat Name</label>
                <input type="text" class="form-input" id="chatNameInput" placeholder="Enter chat name...">
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="app.closeModal('renameChatModal')">Cancel</button>
                <button class="btn-primary" onclick="app.saveRename()">Save</button>
            </div>
        </div>
    </div>

    <!-- URL Contexts Modal -->
    <div class="modal" id="urlContextsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">URL Contexts</h2>
                <button class="modal-close" onclick="app.closeModal('urlContextsModal')">&times;</button>
            </div>
            <button class="btn-primary" onclick="app.openCreateUrlContextModal()" style="margin-bottom: 16px; width: 100%;">
                + Create New URL Context
            </button>
            <div class="prompt-list" id="urlContextList"></div>
        </div>
    </div>

    <!-- Create/Edit URL Context Modal -->
    <div class="modal" id="urlContextEditorModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="urlContextEditorTitle">Create URL Context</h2>
                <button class="modal-close" onclick="app.closeModal('urlContextEditorModal')">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Context Name</label>
                <input type="text" class="form-input" id="urlContextName" placeholder="e.g., Research Articles, Documentation...">
            </div>
            <div class="form-group">
                <label class="form-label">URLs (one per line)</label>
                <textarea class="form-textarea" id="urlContextUrls" placeholder="https://example.com&#10;https://another-example.com&#10;..."></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="app.closeModal('urlContextEditorModal')">Cancel</button>
                <button class="btn-primary" onclick="app.saveUrlContext()">Save</button>
            </div>
        </div>
    </div>

    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.0.0/marked.min.js"></script>
    <script src="../assets/js/api-service.js"></script>
    <script src="../assets/js/ai-chatbot.js"></script>
</body>
</html>